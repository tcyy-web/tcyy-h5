<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <title></title>
  <link href="../../fonts/iconfont.css" rel="stylesheet" />
  <link href="../../css/mui.min.css" rel="stylesheet" />
  <link href="../../css/style.css" rel="stylesheet" />
  <link href="../../css/style-custom.css" rel="stylesheet" />
  <link href="css/kt-style.css" rel="stylesheet" />
</head>

<body>
  <header id="header" class="mui-bar mui-bar-nav">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    <h1 class="mui-title" data-bind="text: headerText">课堂</h1>
  </header>
  <nav class="mui-bar mui-bar-tab">
    <a href="#home" class="mui-tab-item mui-active" >
      <div class="iconfontbox"><i class="iconfont icon-ketang"></i></div>
      <span class="mui-tab-label">课堂</span>
    </a>
    <a class="mui-tab-item" style="overflow:visible;">
      <div class="center-circular">
        <div class="iconfontbox"><i class="iconfont icon-fabuketang"></i></div>
        <span class="mui-tab-label">发布</span>
      </div>
    </a>
    <a href="#wode" class="mui-tab-item">
      <div class="iconfontbox"><i class="iconfont icon-wode"></i></div>
      <span class="mui-tab-label">我的</span>
    </a>
  </nav>
  <div class="mui-content ">
    <div id="home" class="mui-control-content mui-active home">
      <div class="home-top-nav">
        <!-- ko foreach: categorys -->
          <a class="nav-item">
            <div class="nav-iconbox" 
              data-bind="style: {'background-color' : color},
              click: $root.listFn"
            ><i data-bind="attr: {class: icon}"></i></div>
            <p class="nav-label" data-bind="text: title"></p>
          </a>
        <!-- /ko -->
      </div>
      <div class="home-newvideo">
        <div class="title clear">
          <p class="fl">最新视频</p>
          <p data-bind="click: moreFn" class="fr font-small">更多</p>
        </div>
        <div class="video">
        	<!-- ko foreach: newestList -->
          <div class="video-item">
            <div class="thumbnail">
              <div class="img">
                <img src="images/timg2.jpg" alt="">
              </div>
              <i class="iconfont icon-bofang"></i>
              <p class="video-name text-ellipsis">
                <span data-bind="text:title">视频名称名称名称名称名称名称</span>
              </p>
            </div>
            <div class="info">
              <p class="text-ellipsis font-bold curricu-name">
                <span  data-bind="text:title">课程名称课程名称名称名称名称</span>
              </p>
              <p class="clear">
                <span class="fl font-bold">小漂亮</span>
                <span class="fr price font-bold">免费</span>
              </p>
              <p class="clear other">
                <span class="fl">
                  <i class="iconfont icon-liulanjilu"></i>
                  123
                </span>
                <span class="fr">2019.12.23</span>
              </p>
            </div>
          </div>
          <!-- /ko -->
        </div>
      </div>
    </div>
    <div id="wode" class="mui-control-content">
      <ul class="mui-table-view custom-wode-list">
        <li class="mui-table-view-cell">
           <a id="MyVideo" class="mui-navigate-right"><i class="iconfont icon-kecheng"></i>我的课程</a>
        </li>
        <li class="mui-table-view-cell">
           <a id="MyBuy" class="mui-navigate-right"><i class="iconfont icon-wogoumaidexinxi"></i>我购买的</a>
        </li>
        <li class="mui-table-view-cell">
           <a id="MyView" class="mui-navigate-right"><i class="iconfont icon-shipin"></i>我看过的</a>
        </li>
         <li class="mui-table-view-cell">
           <a id="MyOrder" class="mui-navigate-right"><i class="iconfont icon-dingdandaifukuan"></i>我的订单</a>
        </li>
      </ul>
    </div>
  </div>
  <script src="../../third/bluebird.min.js"></script>
  <script src="../../third/loadash.3.10.1.js"></script>
  <script src="../../js/mui.min.js"></script>
  <script src="../../third/knockout.js"></script>
  <script src="../../third/ko.mapping.js"></script>
  <script src="../../js/mui.pullToRefresh.js"></script>
  <script src="../../js/mui.pullToRefresh.material.js"></script>
  <script src="../../js/utils.enums.js"></script>
  <script src="../../js/utils.config.js"></script>
  <script src="../../js/utils.storages.js"></script>
  <script src="../../js/utils.category.js"></script>
  <script src="../../js/utils.auth.js"></script>
  <script src="../../js/utils.upload.js"></script>
  <script src="../../js/utils.request.js" ></script>
  <script src="../../js/utils.common.js" ></script>
  <script src="js/kt-common.js" ></script>
  <script>
    (function($, doc) {
      $.init({
        preloadPages:[{
          id:'KZ_KT_Detail',
          url: './details.html'
        }],
        beforeback: function() {
　　   			  plus.navigator.setStatusBarBackground('#765fc3');
          return true;
        }
      });
      $.plusReady(function() {
      	
        plus.navigator.setStatusBarBackground('#8E78D6');
        // 初始化头部
        var HeaderView = function () {
          var vm = this;
          vm.headerText = ko.observable('课堂');
        }
        var headerView = new HeaderView();
        ko.applyBindings(headerView, document.getElementById('header'));
        // tab改变 
        $.each(doc.querySelectorAll('.mui-bar-tab .mui-tab-item'), function( index, el ) {
          el.addEventListener('tap', function( e ) {
            var text = el.querySelector('.mui-tab-label').innerText;
            if (text == '发布') {
              PublishPage();
            } else {
              headerView.headerText( el.querySelector('.mui-tab-label').innerText );
            }
          });
        });
        /*课堂*/
        (function(){
          var category = categorys.get();
          var categoryColor = {
            1: '#BCABF5',
            2: '#F5ABAB',
            3: '#F5C9AB',
            4: '#B2DE8E',
            5: '#97E8C5',
            6: '#ABBBF5',
            7: '#D5A1F0',
            8: '#EBABF5'
          }
          var BaseView = function() {
            var vm = this;
            // 分类
            vm.categorys = ko.observableArray(_.map(category, function(o) {
              o.icon = enums.category[o.id];
              o.color = categoryColor[o.id];
              return o;
            }));
            // 跳转列表
            vm.listFn = function (data) {
            	console.log("data:"+data.title)
              mui.openWindow({
                id:'KZ_KT_CategoryList',
                url: './list.html',
                show: {
                  aniShow: 'pop-in'
                },
                styles: {
                  popGesture: 'hide'
                },
                waiting: {
                  autoShow: false
                },
                extras: {
                  catergoryid: data.id,
                  headtitle: data.title
                }
              });
            }
            // 跳转更多
            vm.moreFn = function (){
              mui.openWindow({
                id:'KZ_KT_MoreList',
                url: './list.html',
                show: {
                  aniShow: 'pop-in'
                },
                styles: {
                  popGesture: 'hide'
                },
                waiting: {
                  autoShow: false
                }
              });
            }
            // 最新列表
            vm.newestList = ko.observableArray([]);
            
            CourseList({
	            page: 1,
	            limit: 10,
	            ctime: 'desc'
	          }).then(function( reslist ){
							vm.newestList( reslist );
	          });
          }
          var viewModel = new BaseView();
          ko.applyBindings(viewModel, doc.getElementById('home'));

        })();
        /*我的*/
        var wodeWebview = {
          MyVideo: './my-video.html',
          MyBuy: './my-buy.html',
          MyOrder: './my-sell.html',
          MyView: './my-read.html'
        }
        mui('body').on('tap', '#wode a', function(){
          console.log('click');
          var webviewId = this.getAttribute('id');
          console.log(webviewId)
          mui.openWindow({
            id:'KZ_KT_'+ webviewId,
            url: wodeWebview[webviewId],
            show: {
              aniShow: 'pop-in'
            },
            styles: {
              popGesture: 'hide'
            },
            waiting: {
              autoShow: false
            }
          });
        });
      });
    }(mui, document));
  </script>
</body>
</html>