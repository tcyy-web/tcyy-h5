<!DOCTYPE html>
<html class="ui-page-login">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title></title>
	<link href="../../css/mui.min.css" rel="stylesheet" />
	<link href="../../css/style.css" rel="stylesheet" />
	<style>
      #sliderSegmentedControl{
        border-bottom:1px solid #d2d2d2;
        margin-bottom: 10px;
        height: 50px;
        background-color: #ffffff;
      }
      .mui-segmented-control.mui-scroll-wrapper {
        height: 50px;
        overflow: auto !important;
      }
      .mui-segmented-control .mui-control-item {
        line-height: 50px;
        display: inline-block;
        position: relative;
      }
      .mui-segmented-control .mui-control-item:after {
        content: '';
        position: absolute;
        width: 1px;
        height: 20px;
        right: 0;
        bottom: 15px;
        background-color: #d6d6d6;
      }
      .mui-segmented-control .mui-control-item:last-child:after {
        width: 0;
      }
      .mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
        color: #765fc3;
      }
      .mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active:before {
        content: '';
        position: absolute;
        width: 100%;
        height: 3px;
        left: 0;
        bottom: -1px;
        background-color: #765fc3;
      }
      .mui-fullscreen .mui-segmented-control~.mui-slider-group {
        top: 60px;
        background-color: #ffffff;
      }
      .mui-slider .mui-segmented-control.mui-segmented-control-inverted~.mui-slider-group .mui-slider-item {
        border: 0;
      }
  </style>
	<style>
		body,
		.mui-content{
			background-color: #ffffff;
		}
		.mui-row{
			padding: 0 5px;
		}
		.mui-row .mui-col-xs-4{
			margin: 0 5px 10px 5px;
			width: calc(33.33333333% - 10px);
			-webkit-border-radius: 3px;
			-moz-border-radius: 3px;
			border-radius: 3px;
			overflow: hidden;
    	-webkit-box-shadow: #ccc 0px 2px 5px -1px;
    	box-shadow: #ccc 0px 2px 5px -1px;
		}
		.pic-item{
			background-color: #f4f4f4;
			text-align: center;
			height: 100px;
		}
		.pic-item img{
			width: 60px !important;
			height: auto;
		}
		.mui-row .mui-col-xs-4 p{
			color: #303030;
			height: 40px;
			padding: 5px;
			line-height: 15px;
		}
		.mui-row .mui-col-xs-4 p.p {
			color: #bababa;
		}
	</style>

</head>

<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">图片文件夹</h1>
	</header>
		<div class="mui-content">
			<div id="slider" class="mui-slider mui-fullscreen">
				<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<div class="mui-scroll" id="sliderSegmentedControl">
						<a class="mui-control-item mui-active" href="#content1">
              口腔种植
            </a>
            <a class="mui-control-item" href="#content2">
              口腔正畸
            </a>
            <a class="mui-control-item" href="#content3">
              口腔修复
            </a>
            <a class="mui-control-item" href="#content4">
              口腔外科
            </a>
            <a class="mui-control-item" href="#content5">
              口腔内科
            </a>
            <a class="mui-control-item" href="#content6">
              口腔美容
            </a>
					</div>
				</div>
				<div class="mui-slider-group" id="sliderSegmentedContent">
					<div class="mui-slider-item mui-control-content mui-active">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<div class="mui-row">
					        <!--<div class="mui-col-xs-4">
			            	<div class="pic-item flex flex-row-center flex-col-center">
			            		<img src="../../images/picture/bg.png" />
			            	</div>
			            	<p class="flex flex-row-center flex-col-center">刷牙方法</p>
					        </div>-->
									<!--<div class="mui-col-xs-4">
			              <div class="pic-item flex flex-row-center flex-col-center">
			              	<img src="../../images/picture/bg1.png" />
			              </div>
			              <p class="p flex flex-row-center flex-col-center">创建文件夹</p>
					        </div>-->
						    </div>
							</div>
						</div>
					</div>
					<div id="content2" class="mui-slider-item mui-control-content">
            <div class="mui-scroll-wrapper">
              <div class="mui-scroll"><div class="mui-row"></div></div>
            </div>
          </div>
          <div id="content3" class="mui-slider-item mui-control-content">
            <div class="mui-scroll-wrapper">
              <div class="mui-scroll"><div class="mui-row"></div></div>
            </div>
          </div>
          <div id="content4" class="mui-slider-item mui-control-content">
            <div class="mui-scroll-wrapper">
              <div class="mui-scroll"><div class="mui-row"></div></div>
            </div>
          </div>
          <div id="content5" class="mui-slider-item mui-control-content">
            <div class="mui-scroll-wrapper">
              <div class="mui-scroll"><div class="mui-row"></div></div>
            </div>
          </div>
          <div id="content6" class="mui-slider-item mui-control-content">
            <div class="mui-scroll-wrapper">
              <div class="mui-scroll"><div class="mui-row"></div></div>
            </div>
          </div>
				</div>
			</div>
		</div>
		<script src="../../third/knockout.js"></script>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/mui.pullToRefresh.js"></script>
		<script src="../../js/mui.pullToRefresh.material.js"></script>
		<script src="../../js/utils.config.js"></script>
	  <script src="../../js/utils.extend.js"></script>
	  <script src="../../js/utils.storages.js" ></script>
	  <script src="../../js/utils.category.js" ></script>
	  <script src="../../js/utils.auth.js"></script>
	  <script src="../../js/utils.request.js"></script>
		<script>
			(function($, doc) {
				//阻尼系数
				var deceleration = mui.os.ios?0.003:0.0009;
				$('.mui-scroll-wrapper').scroll({
					bounce: false,
					indicators: true, //是否显示滚动条
					deceleration:deceleration
				});
				$.init({
					preloadPages:[{
            id:'pictureList',
            url: './picture-list.html'
          }]
				});
				$.plusReady(function() {
					var limit = 5;
			  	  var groupid = 0;
			  	  var listRequest = {};
			  	  var pictureListWebView = null;
	        var paintItem = function(parent, data) {
	          var boxDiv = doc.createElement('div');
	          boxDiv.className = 'mui-col-xs-4';
	          var imgDiv = doc.createElement('div');
	          imgDiv.className = 'pic-item flex flex-row-center flex-col-center';
	          imgDiv.innerHTML = '<img src="../../images/picture/bg.png" />';
	          boxDiv.appendChild(imgDiv);
	          var p = doc.createElement('p');
	          p.className = 'flex flex-row-center flex-col-center';
	          p.innerText =  data.title;
	          boxDiv.appendChild(p);
	          boxDiv.addEventListener('tap', function(event){
              if (!pictureListWebView) {
                pictureListWebView = plus.webview.getWebviewById('pictureList');
              }
              $.fire(pictureListWebView,'picture-folderid',{
                folderid:data.id
              });
              $.openWindow({
                id: 'pictureList'
              });
	          });
	          parent.appendChild(boxDiv);
	        };
					var getList = function(callback){
						request.ajax('group/getPictureFolder', {
							data: {
								groupid: groupid
							},
							showMsg: false
						}, function(data) {
						  // 处理页面绑定
	             if (data) {
	               var currentContent = doc.querySelector('.mui-control-content.mui-active .mui-row');
	               currentContent.innerHTML = '';
	               $.each(data, function(index,i) {
	               	paintItem(currentContent,i);
	               });
	               listRequest[groupid] = groupid;
	             }
	             if (typeof callback === 'function') {
	               callback();
	             }
						}, function() {
	             if (typeof callback === 'function') {
	               callback();
	             }
						});
					}
	        // 分类
	        var category = categorys.get();
	        if (category.length > 0) {
	            var controls = doc.getElementById("sliderSegmentedControl");
	            var contents = doc.getElementById("sliderSegmentedContent");
	            var controlsHtml = [];
	            var contentsHtml = [];
	            $.each(category, function(index, item) {
	              var _controlHtml = '<a groupid={0} class="mui-control-item" href="#content{1}">{2}</a>';
	              _controlHtml = _controlHtml.format(item.id,index,item.title);
	              controlsHtml.push(_controlHtml);
	              var _contentHtml = '';
	              _contentHtml += '<div id="content{0}" class="mui-slider-item mui-control-content">'+
	                              ' <div class="mui-scroll-wrapper">'+
	                              '  <div class="mui-scroll">'+
	                              '   <div class="mui-row">'+
	                              '   </div>'+
	                              '  </div>'+
	                              ' </div>'+
	                              '</div>';
	              _contentHtml = _contentHtml.format(index, index);
	              contentsHtml.push(_contentHtml);
	            });
	            controls.innerHTML = controlsHtml.join('');
	            contents.innerHTML = contentsHtml.join('');
	            controls.querySelector('.mui-control-item').classList.add('mui-active');
	            contents.querySelector('.mui-control-content').classList.add('mui-active');
	            // 初始加载项目
	            groupid = category[0].id;
	            getList();
	        }
	        // 切换tab
	        doc.querySelector('.mui-slider').addEventListener('slide', function(event) {
	          var contentValue = event.detail.slideNumber;
	          var currentTab = doc.querySelector('.mui-control-item.mui-active');
	          groupid = currentTab.getAttribute('groupid');
	          if (listRequest[groupid]) {
	            return;
	          }
	          getList();
	        });
					//循环初始化所有下拉刷新，上拉加载。
					$.each(doc.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
						$(pullRefreshEl).pullToRefresh({
							down: {
								callback: function() {
	                var self = this;
								  getList(function() {
								    self.endPullDownToRefresh();
								  });
								}
							}
						});
					});
				});
			})(mui, document);
		</script>
	</body>

</html>