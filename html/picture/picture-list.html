<!DOCTYPE html>
<html class="ui-page-login">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title></title>
	<link href="../../css/mui.min.css" rel="stylesheet" />
	<link href="../../css/style.css" rel="stylesheet" />
	<style>
		body,
		.mui-content{
			background-color: #ffffff;
		}
	  .mui-pull-top-tips {
      z-index: 10;
    }
		.mui-row{
			padding: 0 5px;
		}
		.mui-row .mui-col-xs-6{
			margin: 10px 5px;
			width: calc(50% - 10px);
			-webkit-border-radius: 3px;
			-moz-border-radius: 3px;
			border-radius: 3px;
			overflow: hidden;
    	-webkit-box-shadow: #ccc 0px 2px 5px -1px;
    	box-shadow: #ccc 0px 2px 5px -1px;
		}
		.pic-item{
			text-align: center;
		}
		.pic-item img{
			width: 100%;
			height: auto;
		}
		.pic-item.upload{
			text-align: center;
			height: 100px;
			background-color: #f4f4f4;
		}
		.pic-item.upload img {
			width: 60px;
		}
		.mui-row .mui-col-xs-6 p{
			color: #303030;
			height: 40px;
			padding: 5px;
			line-height: 15px;
		}
		.mui-row .mui-col-xs-6 p.p {
			color: #bababa;
		}
	</style>

</head>

<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">图片</h1>
	</header>
		<div class="mui-content">
			<div class="mui-fullscreen">
		    <div class="mui-scroll-wrapper">
		      <div id="pullrefresh" class="mui-scroll">
						<div id="contentBox" class="mui-row">
			        <!--<div class="mui-col-xs-6">
	            	<div class="pic-item flex flex-row-center flex-col-center">
	            		<img src="../../images/video/sc10.png" />
	            	</div>
	            	<p class="flex flex-row-center flex-col-center">刷牙方法</p>
			        </div>
			        <div class="mui-col-xs-6">
	              <div class="pic-item upload flex flex-row-center flex-col-center">
	              	<img src="../../images/picture/bg1.png" />
	              </div>
	              <p class="p flex flex-row-center flex-col-center">上传图片</p>
			        </div>-->
				    </div>
		      </div>
		    </div>
		  </div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/mui.pullToRefresh.js"></script>
		<script src="../../js/mui.pullToRefresh.material.js"></script>
		<script src="../../js/utils.config.js"></script>
	  <script src="../../js/utils.extend.js"></script>
	  <script src="../../js/utils.storages.js" ></script>
	  <script src="../../js/utils.auth.js"></script>
	  <script src="../../js/utils.request.js"></script>
		<script>
			(function($, doc) {
				//阻尼系数
				var deceleration = mui.os.ios?0.003:0.0009;
				$('.mui-scroll-wrapper').scroll({
					bounce: false,
					indicators: true, //是否显示滚动条
					deceleration:deceleration
				});
				$.init();
				$.plusReady(function() {
			  	var folderid = 0;
 					var page = 1;
          var limit = 20;
          var more = true;
          var $pullrefresh = $('#pullrefresh');
          var $contentBox = doc.getElementById('contentBox');
          /*图片预览*/
          var urls = [];
          var images = [];
					var picturePre = function(){
						urls.length = 0;
						// 获取图片地址列表
					  images = doc.querySelectorAll('.pic-item img');
					  for(var i = 0; i < images.length; i++) {
					    urls.push(images[i].src);
					  }
					}
				  // 监听图片的点击
				  $('body').on('tap', 'img', function() {
				    // 查询图片在列表中的位置
				    // 由于dom节点列表是伪数组，需要处理一下
				    var index = [].slice.call(images).indexOf(this);
				    plus.nativeUI.previewImage(urls, {
				      current: index,
				      loop: true,
				      indicator: 'number'
				    });
				  });
	        var paintItem = function(data) {
	          var boxDiv = doc.createElement('div');
	          boxDiv.className = 'mui-col-xs-6';
	          var imgDiv = doc.createElement('div');
	          imgDiv.className = 'pic-item flex flex-row-center flex-col-center';
	          imgDiv.innerHTML = '<img src="{0}" />'.format(data.image);
	          boxDiv.appendChild(imgDiv);
	          var p = doc.createElement('p');
	          p.className = 'flex flex-row-center flex-col-center';
	          p.innerText =  data.title;
	          boxDiv.appendChild(p);
	          $contentBox.appendChild(boxDiv);
	        };
					var getList = function(callback){
						request.ajax('Picture/getlist', {
							data: {
								folderid: folderid
							},
							showMsg: false
						}, function(data) {
                // 处理页面绑定
	             if (data && data.data) {
	               if (page === 1) {
	                 $contentBox.innerHTML = '';
	               }
	               $.each(data.data, function(index,i) {
	                 paintItem(i);
	               });
	               picturePre();
	             }
	             // 判断是否有下一页数据
	             if (data && data.data && data.data.length === limit) {
	               more = true;
	             } else {
	               more = false;
	             }
	             if (typeof callback === 'function') {
	               callback();
	             }
						}, function() {
	             if (typeof callback === 'function') {
	               callback();
	             }
						});
					}
	        // 刷新分类
          window.addEventListener('picture-folderid', function(e){
            folderid = e.detail.folderid;
            $pullrefresh.pullToRefresh().refresh(true);
            getList();
          });
					$pullrefresh.pullToRefresh({
            down: {
              callback: function() {
                page = 1;
                var self = this;
                getList(function() {
                  self.endPullDownToRefresh();
                  $pullrefresh.pullToRefresh().refresh(true);
                });
              }
            },
            up: {
              callback: function() {
                var self = this;
                if (more) {
                  page = page + 1;
                  getList(function(){
                    self.endPullUpToRefresh(false);
                  });
                  return;
                }
                self.endPullUpToRefresh(true);
              }
            }
          });
				});
			})(mui, document);
		</script>
	</body>

</html>