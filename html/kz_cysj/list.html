<!DOCTYPE html>
<html class="ui-page-my">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title></title>
	<link rel="stylesheet" href="../../css/iconfont.css" />
	<link href="../../css/mui.min.css" rel="stylesheet" />
	<link href="../../css/style.css" rel="stylesheet" />
  <style>
    .mui-pull-top-tips {
      z-index: 10;
    }
    .mui-bar-tab{
      background-color: #fff;
    }
    .mui-bar-tab .mui-tab-item.mui-active{
      color: #765fc3;
    }
    .mui-bar-tab .mui-tab-item{
      color: #7c7c7c;
    }
    .mui-bar-tab .iconfont {
      margin-right: 5px;
    }
    .mui-control-content{
      height: 100%;
      position: relative;
    }
    .lists{
      padding: 5px;
    }
    .lists .item{
      text-align: center; 
      width: calc(50% - 10px);
      width: -webkit-calc(50% - 10px); 
      height:200px; 
      margin: 5px;
      -webkit-border-radius: 5px;
      border-radius: 5px;
      background-color:#ffffff; 
      float:left;
      overflow: hidden;
    }
    .lists .item .img{ 
      width: 100%; 
      height:100%; 
      overflow: hidden;
    }
    .item .img img{
      height: 100%;
      width: auto;
    }
  </style>
</head>

<body>
  <header class="mui-bar mui-bar-nav">
  	<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
  	<h1 class="mui-title">创意设计</h1>
  </header>
  <nav class="mui-bar mui-bar-tab">
    <a data-groupid="2" class="mui-tab-item mui-active" href="#tabbar">
      <span class="mui-tab-label"><i class="iconfont icon-cysj"></i>创意无限</span>
    </a>
    <a data-groupid="1" class="mui-tab-item" href="#tabbar2">
      <span class="mui-tab-label"><i class="iconfont icon-qysj"></i>前沿设计</span>
    </a>
  </nav>
  <div class="mui-content">
    <div id="tabbar" class="mui-control-content mui-active">
      <div class="mui-scroll-wrapper">
        <div class="mui-scroll">
          <div class="lists clearFix">
            <!--<div class="item">
              <div class="img flex flex-col-center">
                <img src="../../images/profile/sc5.png"  />
              </div>
            </div>-->
          </div>
        </div>
      </div>
    </div>
    <div id="tabbar2" class="mui-control-content">
      <div class="mui-scroll-wrapper">
        <div class="mui-scroll">
          <div class="lists clearFix">
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="../../js/mui.min.js"></script>
  <script src="../../js/mui.pullToRefresh.js"></script>
  <script src="../../js/mui.pullToRefresh.material.js"></script>
  <script src="../../js/utils.config.js"></script>
  <script src="../../js/utils.extend.js"></script>
  <script src="../../js/utils.storages.js" ></script>
  <script src="../../js/utils.category.js" ></script>
  <script src="../../js/utils.auth.js"></script>
  <script src="../../js/utils.request.js"></script>
  <script>
    (function($, doc) {
      //阻尼系数
      var deceleration = $.os.ios?0.003:0.0009;
      $('.mui-scroll-wrapper').scroll({
        bounce: false,
        indicators: true, //是否显示滚动条
        deceleration:deceleration
      });
      $.init();
      $.plusReady(function() {
        var limit = 6;
        var groupid = 2;
        // 图片预览数据
        var images = {
          2: [], //创意设计
          1: [] //前沿设计
        }
        // 请求参数存储
        var listRequest = {};
         /*图片预览*/
        var previewImage = function(index) {
          plus.nativeUI.previewImage(images[groupid], {
            current: index,
            loop: true,
            indicator: 'number'
          });
        }
        // 画每一项
        var paintItem = function(parent, data) {
          images[groupid].push(data.image);
          var len = images[groupid].length;
          var div = doc.createElement('div');
          div.className = 'item';
          div.innerHTML = '<div class="img flex flex-col-center"><img src="{0}" /></div>'.format(data.image);
          div.addEventListener('tap', function(){
            previewImage(len - 1);
          });
          parent.appendChild(div);
        };
        var getList = function(page,callback){
          if (listRequest[groupid] && page !== 1 && listRequest[groupid].more === false) {
            return;
          }
          request.loginAjax('Design/getList', {
            data: {
              group_id: groupid,
              page: page,
              limit: limit
            },
            showMsg: false
          }, function(data) {
            // 处理页面绑定
             if (data && data.data) {
               var currentContent = doc.querySelector('.mui-control-content.mui-active .lists');
               if (page === 1) {
                 currentContent.innerHTML = '';
                 images[groupid] = [];
               }
               $.each(data.data, function(index,i) {
                 paintItem(currentContent,i);
               });
             }
             // 判断是否有下一页数据
             if (data && data.data && data.data.length === limit) {
               listRequest[groupid] = {
                 page: page,
                 more: true
               }
             } else {
               listRequest[groupid] = {
                 page: page,
                 more: false
               }
             }
             if (typeof callback === 'function') {
               callback();
             }
          }, function() {
             if (typeof callback === 'function') {
               callback();
             }
          });
        }
        getList(1);
        // 切换tab
        $.each(doc.querySelectorAll('.mui-bar-tab .mui-tab-item'), function(index, el) {
          	 el.addEventListener('tap', function(e) {
              var _groupid = this.getAttribute('data-groupid');
              groupid = _groupid;
              if (listRequest[groupid]) {
                return;
              }
              getList(1);
          });
        });
        //循环初始化所有下拉刷新，上拉加载。
        $.each(doc.querySelectorAll('.mui-content .mui-scroll'), function(index, pullRefreshEl) {
          $(pullRefreshEl).pullToRefresh({
            down: {
              callback: function() {
                var self = this;
                getList(1, function() {
                  self.endPullDownToRefresh();
                  $(pullRefreshEl).pullToRefresh().refresh(true);
                });
              }
            },
            up: {
              callback: function() {
                var self = this;
                if (listRequest[groupid]) {
                  if (listRequest[groupid].more === true) {
                    var page = listRequest[groupid].page + 1;
                    getList(page, function(){
                      self.endPullUpToRefresh(false);
                    })
                    return;
                  }
                }
                self.endPullUpToRefresh(true);
              }
            }
          });
        });
      });
    })(mui, document);
  </script>
</body>

</html>

