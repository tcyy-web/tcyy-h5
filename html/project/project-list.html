<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>项目</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/iconfont.css" />
		<link rel="stylesheet" href="../../css/mui.min.css">
		<link href="../../css/style.css" rel="stylesheet" />
		<style>
		  ::-webkit-scrollbar{
		    width: 0;
		  }
			.mui-content {
				position:relative;
			}
			.mui-row.mui-fullscreen>[class*="mui-col-"] {
				height: calc(100% - 60px);
				height: -webkit-calc(100% - 60px);
			}
			.mui-col-xs-3,
			.mui-control-content {
				overflow-y: auto;
				height: 100%;
			}
			.mui-col-xs-3 {
				position: relative;
				background-color: #f1f1f1;
			}
			.mui-col-xs-3:before {
				position: absolute;
		    top: 0;
		    bottom: 0;
		    right: 0;
		    width: 1px;
		    content: '';
		    -webkit-transform: scaleX(.5);
		    transform: scaleX(.5);
		    background-color: #dedede;
			}
			.mui-control-content {
				background-color: #ffffff;
				padding: 10px;
			}
			.content-box {
				height: calc(100% - 50px);
				height: -webkit-calc(100% - 50px);
			}
			/*左边*/
			.mui-segmented-control.mui-segmented-control-inverted.mui-segmented-control-vertical .mui-control-item,
			.mui-segmented-control.mui-segmented-control-inverted.mui-segmented-control-vertical .mui-control-item.mui-active {
				border-bottom: 0;
			}
			.mui-segmented-control .mui-control-item {
				width: 100%;
				margin-top: 20px;
				overflow: initial;
			}
			.mui-segmented-control .mui-control-item .category {
				position: relative;
			}
			.mui-segmented-control .mui-control-item:first-child .category:before {
				display: none;
			}
			.mui-segmented-control .mui-control-item .category:before {
				position: absolute;
				z-index: 2;
				top: -20px;
				left: 50%;
				content: '';
				width: 1px;
				height: 20px;
				background-color: #dbdbdb;
			}
			.mui-segmented-control .mui-control-item .category .c-icon {
				width: 40px;
				height: 40px;
				background-color: #dbdbdb;
				-webkit-border-radius: 50%;
				border-radius: 50%;
				color: #aaaaaa;
			}
			.mui-segmented-control .mui-control-item .category > p {
				line-height: 30px;
				color: #3a3a3a;
			}
			.mui-segmented-control .mui-control-item.mui-active .category:after {
				position: absolute;
				right: 0;
				bottom: 15px;
				z-index: 2;
				content: '';
				display: block;
				width: 0;height: 0;
				border-top: 10px solid transparent;
				border-bottom: 10px solid transparent;
				border-right: 10px solid #ffffff;
			}
			.mui-segmented-control .mui-control-item.mui-active .category .c-icon {
				background-color: #765fc3;
				color: #ffffff;
			}
			.mui-segmented-control .mui-control-item.mui-active .category > p {
				color: #765fc3;
			}
			/*右边*/
			.add-project {
				line-height: 50px;
				height: 50px;
				width: 100%;
				text-align: right;
				padding: 0 10px;
				z-index: 10;
				background-color: #f9f9f9;
				color: #f34336;
			}
			.mui-table-view:before {
				display: none;
			}
			.mui-table-view:after{
				background-color: #dedede;
			}
			.mui-table-view-cell {
				padding: 0;
			}
			.mui-table-view-cell:after{
				background-color: #dedede;
			}
			.mui-table-view-cell .img {
				height: 180px;
				overflow: hidden;
			}
			.mui-table-view-cell .img img {
				height: 100%;
				width: auto;
			}
			.bill-item {
				position: relative;
				padding-right: 50px;
				background-color: #ffffff;
			}
			.bill-item .flex p {
				width: 100px;
				padding: 5px 0;
				position: relative;
				font-size: 14px;
				color: #292929;
				word-break: break-all;
			}
			.bill-item .flex p:first-child:before {
				position: absolute;
				right: 0;
				top: 10px;
				content: '';
				width: 1px;
				height: 10px;
				background-color: #565656;
			}
			.bill-item .flex p:last-child {
				padding-left: 5px;
			}
			.bill-item > p{
				padding: 5px 0;
				text-align: left;
				font-size: 18px;
				color: #f34336;
			}
			.bill-item > p span {
				font-size: 14px;
				color: #bbbbbb;
				margin-left: 5px;
			}
			.bill-add {
				position: absolute;
				right: 5px;
				top: 10px;
				width: 40px;
				height: 40px;
				background-color: #765fc3;
				-webkit-border-radius: 50%;
				border-radius: 50%;
			}
			.bill-add:before,
			.bill-add:after{
				content: '';
				position: absolute;
				background-color: #ffffff;
			}
			.bill-add:before {
				width: 2px;
				top: 10px;
				left: 19px;
				height: 20px;
			}
			.bill-add:after {
				top: 19px;
				left: 10px;
				height: 2px;
				width: 20px;
			}
		</style>
		<style>
			/*购物车*/
			.shop-car {
				position: absolute;
				left: 0;
				width: 100%;
				bottom: 0;
				z-index: 20;
				height: 60px;
			}
			.shop-car.active {
				height: 60%;
			}
			.shop-car~.shop-car-bg {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				z-index: 19;
				background-color: rgba(0,0,0,0.3);
				display: none;
			}
			.shop-car.active~.shop-car-bg {
				display: block;
			}
			.shop-car.active .sc-tips{
				top: -70px;
			}
			.shop-car.active .sc-tips:before {
				content: '';
				position: absolute;
				bottom: -10px;
				left: 24px;
				width: 0;
				height: 0;
				border-left: 6px solid transparent;
				border-right: 6px solid transparent;
				border-bottom: 8px solid #ebebeb;
			}
			.shop-car .sc-tips {
				position: absolute;
				z-index: 21;
				top: -10px;
				left: 10px;
				width: 60px;
				height: 60px;
				background-color: #0d1520;
				-webkit-border-radius: 50%;
				-moz-border-radius: 50%;
				border-radius: 50%;
				-webkit-transition: 0.5s linear top;
				transition: 0.5s linear top;
			}
			.shop-car .sc-tips p {
				position: absolute;
				top: -5px;
				right: -5px;
				color: #ffffff;
				width: 25px;
				height: 25px;
				line-height: 25px;
				text-align: center;
				font-size: 12px;
				background-color: #f34336;
				-webkit-border-radius: 50%;
				-moz-border-radius: 50%;
				border-radius: 50%;
			}
			.shop-car .sc-items {
				height: calc(100% - 60px);
				height: -webkit-calc(100% - 60px);
        -webkit-transition: .2s ease-out height;
        transition: .2s ease-out height;
				background-color: #ffffff;
				overflow: hidden;
			}
			.shop-car .sc-items .sc-title {
				padding: 0 10px;
				background-color: #ebebeb;
				color: #9b9b9b;
				font-size: 14px;
				height: 40px;
				line-height: 40px;
			}
			.shop-car .sc-clear {
				float: right;
			}
			.shop-car .sc-clear img {
				height: 16px;
				width: auto;
				position: relative;
				top: -1px;
				margin-right: 2px;
			}
			.shop-car .sc-box {
				padding:0 10px;
				height: calc(100% - 40px);
				height: -webkit-calc(100% - 40px);
				overflow-y: auto;
			}
			.shop-car .sc-box .sc-item {
				position: relative;
				padding: 15px 0;
			}
			.shop-car .sc-box .sc-item:before {
				position: absolute;
		    right: 0;
		    bottom: 0;
		    left: 0;
		    height: 1px;
		    content: '';
		    -webkit-transform: scaleY(.5);
		    transform: scaleY(.5);
		    background-color: #c8c7cc;
			}
			.shop-car .sc-box .sc-item .clearFix > p {
				float: left;
				font-size: 18px;
			}
			.shop-car .sc-box .sc-item .clearFix > p.name {
				color:#292929;
				width: 50%;
				padding-right: 10px;
			}
			.shop-car .sc-box .sc-item .clearFix > p.money {
				color:#f34336;
				word-break: break-all;
				width: calc(50% - 100px);
				width: -webkit-calc(50% - 100px);
			}
			.shop-car .sc-box .sc-item .tools {
				float: right;
				position: relative;
				top: -5px;
			}
			.shop-car .sc-total {
				height: 60px;
				line-height: 60px;
				background-color: #3f4249;
				font-size: 16px;
				color: #ffffff;
			}
			.shop-car .sc-total .sc-money {
				width: calc(100% - 100px);
				width: -webkit-calc(100% - 100px);
				float: left;
				padding-left: 80px;
				padding-right: 10px;
        -webkit-transition: .2s ease-out padding;
        transition: .2s ease-out padding;
			}
			.shop-car.active .sc-total .sc-money {
				padding-left: 10px;
			}
			.shop-car .sc-total .sc-money .f1 {
				font-size: 14px;
				color: #b7b7b7;
			}
			.shop-car .sc-total .btn-submit {
				width: 100px;
				float: right;
				color: #ffffff;
				text-align: center;
				font-size: 16px;
				background-color: #765fc3;
			}

			.tools {
				width: 90px;
				margin-left: 10px;
			}
			.tools > p {
				font-size: 14px;
				font-weight: 700;
				color: #696969;
				text-align: center;
			}
			.tools .item {
				position: relative;
				width: 30px;
				height: 30px;
				background-color:#f34336;
				-webkit-border-radius: 50%;
				-moz-border-radius: 50%;
				border-radius: 50%;
			}
			.tools .item.item-jia:before,
			.tools .item.item-jia:after,
			.tools .item.item-jian:before {
				position: absolute;
				content: '';
			}
			.tools .item.item-jian:before {
				top: 13px;
				left: 8px;
				width: 14px;
				height: 2px;
				background-color: #ffffff;
			}
			.tools .item.item-jia:before {
				top: 13px;
				left: 8px;
				width: 14px;
				height: 2px;
				background-color: #ffffff;
			}
			.tools .item.item-jia:after {
				top: 7px;
				left: 14px;
				width: 2px;
				height: 14px;
				background-color: #ffffff;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">项目</h1>
		</header>
		<div class="mui-content mui-row mui-fullscreen">
			<div class="mui-col-xs-3">
				<div id="segmentedControls" class="mui-segmented-control mui-segmented-control-inverted mui-segmented-control-vertical">
					<!--<a class="mui-control-item mui-active" data-index="1" href="#content1">
						<div class="category">
							<div class="flex flex-col-center">
								<div class="c-icon flex flex-col-center flex-row-center"><i class="iconfont icon-kouqiangbaojian"></i></div>
							</div>
							<p>口腔修复</p>
						</div>
					</a>-->
				</div>
			</div>
			<div class="mui-col-xs-9">
				<div id="addProject" class="add-project">
					<span>添加项目</span>
				</div>
				<div id="segmentedControlContents" class="content-box">
					<!--<div id="content1" class="mui-control-content mui-active">
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								<div class="img flex flex-col-center">
									<img src="../../images/project/banner.png" />
								</div>
								<div class="bill-item">
									<div class="flex">
										<p>编号：01by01by01by01by01by</p>
										<p class="flex-1">牙齿修复牙齿修复牙齿修复牙齿修复牙齿修复</p>
									</div>
									<p>￥318<span>元</span></p>
									<div class="bill-add"></div>
								</div>
							</li>
						</ul>
					</div>-->
				</div>
			</div>
			<div id="shop-car-box" class="shop-car">
				<div id="shop-car" class="sc-tips flex flex-col-center flex-row-center">
					<p>18+</p>
					<img src="../../images/project/edit.png"/>
				</div>
				<div class="sc-items">
					<div class="sc-title">
						<span>治疗清单</span>
						<div class="sc-clear">
							<img src="../../images/project/del.png"/>
							<span>清空清单</span>
						</div>
					</div>
					<div class="sc-box">
						<div class="sc-item">
							<div class="clearFix">
								<p class="name">口腔修复口腔修复口腔修复口腔修复口腔修复口腔修复</p>
								<p class="money">￥213</p>
								<div class="tools flex flex-row-center">
									<div class="item item-jian"></div>
									<p class="flex-1">99</p>
									<div class="item item-jia"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="sc-total">
					<div class="sc-money">
						<span class="f1">共</span>
						<span>￥</span>
						<span>152</span>
						<span class="f1">元</span>
					</div>
					<div id="submitCar" class="btn-submit"><span>提交</span></div>
				</div>
			</div>
			<div class="shop-car-bg"></div>
		</div>
		<script src="../../js/mui.min.js"></script>
    <script src="../../js/mui.pullToRefresh.js"></script>
    <script src="../../js/mui.pullToRefresh.material.js"></script>
		<script src="../../js/utils.config.js"></script>
		<script src="../../js/utils.enums.js"></script>
		<script src="../../js/utils.extend.js"></script>
		<script src="../../js/utils.storages.js" ></script>
		<script src="../../js/utils.category.js" ></script>
		<script src="../../js/utils.auth.js"></script>
		<script src="../../js/utils.request.js"></script>
		<script>
      window.addEventListener('refresh', function(e){
          location.reload();
      });
			(function($, doc) {
				$.init({
				  preloadPages:[{
				    id:'projectAdd',
				    url: './project-add.html'
				  },{
            id:'projectBillEdit',
            url: './project-bill.html'
				  }]
				});
				$.plusReady(function() {
				  var limit = 10;
				  var groupid = 0;
				  var listRequest = {};
				  var getProjects = function(page) {
				    console.log(JSON.stringify(listRequest[groupid]));
            request.loginAjax('project/getlist',{
              data: {
                groupid:groupid,
                page:page,
                limit:limit
              }
            },function(data) {
              console.log(JSON.stringify(data));
            });
				  }
				  // 分类
				  var category = categorys.get();
				  if (category.length > 0) {
    				  var controls = doc.getElementById("segmentedControls");
    				  var contents = doc.getElementById("segmentedControlContents");
    				  var controlsHtml = [];
    				  var contentsHtml = [];
    				  $.each(category, function(index, item) {
                var _controlHtml = '';
                _controlHtml += '<a class="mui-control-item" groupid="{0}" href="#content{1}">'+
                        ' <div class="category">'+
                        '  <div class="flex flex-col-center">'+
                        '   <div class="c-icon flex flex-col-center flex-row-center"><i class="{2}"></i></div>'+
                        '  </div>'+
                        '  <p>{3}</p>'+
                        ' </div>'+
                        '</a>';
                _controlHtml = _controlHtml.format(item.id, index, enums.category[item.id], item.title);
    				  	  controlsHtml.push(_controlHtml);
    				  	  var _contentHtml = '';
    				  	  _contentHtml += '<div id="content{0}" class="mui-control-content">'+
    				  	                  ' <ul class="mui-table-view">'+
    				  	                  ' </ul>'+
    				  	                  '</div>';
    				  	  _contentHtml = _contentHtml.format(index);
    				  	  contentsHtml.push(_contentHtml);
    				  });
    				  controls.innerHTML = controlsHtml.join('');
    				  contents.innerHTML = contentsHtml.join('');
  				    controls.querySelector('.mui-control-item').classList.add('mui-active');
  				    contents.querySelector('.mui-control-content').classList.add('mui-active');
    				  // 初始加载项目
            groupid = category[0].id;
            getProjects(1);
    				}
				  // 添加项目
				  var addProject = doc.getElementById('addProject');
				  var projectAddWebview = null;
          addProject.addEventListener('tap', function(event) {
            if (!projectAddWebview) {
              projectAddWebview = plus.webview.getWebviewById('projectAdd');
            }
            $.fire(projectAddWebview,'project-groupid',{
              groupid:groupid
            });
            $.openWindow({
              id: 'projectAdd'
            });            
          }); 
          // tab
          $.each(doc.querySelectorAll('.mui-control-item'), function(index, item) {
            item.addEventListener('tap', function(event){
              groupid = this.getAttribute('groupid');
//            morePage = true;
//            getList();
              console.log(groupid);
            });
          });
          // 下拉刷新 上拉加载
          $.each(doc.querySelectorAll('.content-box .mui-control-content'), function(index, pullRefreshEl) {
            $(pullRefreshEl).pullToRefresh({
              down: {
                callback: function() {
                  console.log(1);
                  this.endPullDownToRefresh(true);
//                this.endPullUpToRefresh(false);
                }
              },
              up: {
                callback: function() {
                  console.log(2);
                  this.endPullUpToRefresh(false);
                }
              }
            });
          });
				  // 购物车
          var shopCarBox = doc.querySelector('#shop-car-box');
          var shopCar = doc.getElementById('shop-car');
          shopCar.addEventListener('tap', function(e) {
            if (shopCarBox.classList.contains('active')) {
              shopCarBox.classList.remove('active');
            } else {
              shopCarBox.classList.add('active');
            }
          });
          // 提交购物车
          var submitCar = doc.getElementById('submitCar');
          var projectBillEditWebview = null;
          submitCar.addEventListener('tap', function(event) {
            if (!projectBillEditWebview) {
              projectBillEditWebview = plus.webview.getWebviewById('projectBillEdit');
            }
            $.fire(projectBillEditWebview,'project-bill',{
            });
            $.openWindow({
              id: 'projectBillEdit'
            });            
          }); 
				});
			}(mui, document));
		</script>
	</body>

</html>