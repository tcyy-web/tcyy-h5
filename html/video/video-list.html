<!DOCTYPE html>
<html class="ui-page-login">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title></title>
	<link href="../../css/mui.min.css" rel="stylesheet" />
	<link href="../../css/style.css" rel="stylesheet" />
	<style>
		.mui-table-view{ background: none;}
		.mui-table-view .mui-table-view-cell{
			padding:5px 0;
			border:none;
		}
		.mui-control-content {
			display: none !important;
		}
		.mui-control-content.mui-active {
			display: block !important;
		}
	/* CSS 视频*/
	.list-item{ width:95%; height:auto; padding-bottom:10px;  margin:auto; background-color:#ffffff; border:1px solid #; -webkit-border-radius: 3px;
	-moz-border-radius: 3px;
	border-radius: 3px;
	-webkit-box-shadow: #666 0px 0px 10px;
	-moz-box-shadow: #666 0px 0px 10px;
	box-shadow: #666 0px 0px 10px; }
	.list-item img{ width:100%; height:auto; margin-bottom:10px;}
	.lname{ width:100%;  margin:auto;  height:40px; line-height:40px; display:inline-block; background:url(../../images/tab-vedio/sc11.png) no-repeat right;}
	.lname span{ font-family:'微软雅黑'; color:#303030; font-size:1em; margin-left:15px;}
	</style>

</head>

<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">视频</h1>
	</header>
		<div class="mui-content">
			<div class="mui-slider mui-fullscreen">
				<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<div class="mui-scroll" id="sliderSegmentedControl" >
						<!--<a class="mui-control-item mui-active" href="#item1mobile">
							儿童牙科
						</a>-->
					</div>
				</div>
				<div class="mui-slider-group" id="sliderSegmentedContent">
					<!--<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view">
									<li class="mui-table-view-cell">
										<section class="list-item">
										    <img src="../../images/tab-vedio/sc10.png" />
										    <a class="lname"><span>形牙烤瓷修复</span></a>
										</section>
									</li>

								</ul>
							</div>
						</div>
					</div>-->
				</div>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/mui.pullToRefresh.js"></script>
		<script src="../../js/mui.pullToRefresh.material.js"></script>
    <script src="../../js/utils.extend.js"></script>
    <script src="../../js/utils.storages.js" ></script>
    <script src="../../js/utils.category.js" ></script>
    <script src="../../js/utils.auth.js"></script>
    <script src="../../js/utils.request.js"></script>
		<script>
			(function($, doc) {
				//阻尼系数
				var deceleration = $.os.ios?0.003:0.0009;
				$('.mui-scroll-wrapper').scroll({
					bounce: false,
					indicators: true, //是否显示滚动条
					deceleration:deceleration
				});
				$.init();
				$.plusReady(function() {
				  var groupid = 0;
          var page = 1;
          var morePage = true;
          var limit = 10;
					var getList = function(){
					  if (!morePage) {
					    return;
					  }
						request.ajax('Video/getList', {
							data: {
								groupid: groupid,
								page: page,
								limit: limit
							}
						}, function(data) {
               if (data.data && data.data.length > 0) {
                 var currentTab = doc.querySelector('.mui-control-content.mui-active .mui-table-view');
                 var _views = [];
                 $.each(data.data, function(index, i) {
                   var _view = '<li class="mui-table-view-cell"></li>'+
                               ' <section class="list-item">'+
                               '  <img src="{0}"/>'+
                               '  <a class="lname"><span>{1}</span></a>'+
                               ' </section>'+
                               '</li>';
                   _view = _view.format(i.image, i.title);
                 	_views.push(_view);
                 });
                 if (page === 1) {
                   currentTab.innerHTML = _views.join('');
                 } else {
                   currentTab.innerHTML = currentTab.innerHTML + _views.join('');
                 }
               } else {
                 morePage = false;
               }
						});
					}
          // 分类
          var category = categorys.get();
          if (category.length > 0) {
              var controls = doc.getElementById("sliderSegmentedControl");
              var contents = doc.getElementById("sliderSegmentedContent");
              var controlsHtml = [];
              var contentsHtml = [];
              $.each(category, function(index, item) {
                var _controlHtml = '<a groupid={0} class="mui-control-item" href="#content{1}">{2}</a>';
                _controlHtml = _controlHtml.format(item.id,index,item.title);
                controlsHtml.push(_controlHtml);
                var _contentHtml = '';
                _contentHtml += '<div id="content{0}" class="mui-slider-item mui-control-content">'+
                                ' <div class="mui-scroll-wrapper">'+
                                '  <div class="mui-scroll">'+
                                '   <ul class="mui-table-view">'+
                                '   </ul>'+
                                '  </div>'+
                                ' </div>'+
                                '</div>';
                _contentHtml = _contentHtml.format(index, index);
                contentsHtml.push(_contentHtml);
              });
              controls.innerHTML = controlsHtml.join('');
              contents.innerHTML = contentsHtml.join('');
              controls.querySelector('.mui-control-item').classList.add('mui-active');
              contents.querySelector('.mui-control-content').classList.add('mui-active');
              // 初始加载项目
              groupid = category[0].id;
              getList();
          }
          $.each(doc.querySelectorAll('.mui-control-item'), function(index, item) {
            item.addEventListener('tap', function(event){
              groupid = this.getAttribute('groupid');
              page = 1;
              morePage = true;
              getList();
            });
          });
					//循环初始化所有下拉刷新，上拉加载。
					$.each(doc.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
						$(pullRefreshEl).pullToRefresh({
							down: {
								callback: function() {
								  page = 1;
								  morePage = true;
								  getList();
									var self = this;
									self.endPullDownToRefresh();
								}
							},
							up: {
								callback: function() {
								  page ++;
								  getList();
									var self = this;
									self.endPullUpToRefresh();
								}
							}
						});
					});
				});
			})(mui, document);
		</script>
	</body>

</html>