<!DOCTYPE html>
<html class="ui-page-my">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title></title>
	<link href="../../css/mui.min.css" rel="stylesheet" />
	<link href="../../css/style.css" rel="stylesheet" />
	<style>
    .mui-content{
      height: auto;
      background: #fff;
      padding-bottom: 50px;
    }
    .mui-pull-right{line-height: 44px;}
    .main{
      padding: 10px;
    }
    .wb-top{
      height:60px;
      position: relative;
    }
    .wb-top .img{
      width: 60px;
      height:60px;
      margin-right: 10px;
      overflow: hidden;
    }
    .wb-top .img img{
      width: auto;
      height: 100%;
    }
    .wb-top h2{
      font-size:16px;
      color: #010101;
      font-weight: normal;
      padding-top:5px;
      padding-bottom: 15px; 
      padding-right: 70px;
    }
    .wb-top h2+p{
      font-size:14px;
      color:#7c7c7c;
    }
    .wb-top ins{
      position: absolute;
      top:5px;
      right:0;
      text-decoration: none;
      padding:0 5px;
      background:#f4f4f4;
      height: 20px;
      border-radius: 5px;
      -webkit-border-radius: 5px;
      font-size:12px;
      color:#6d6d6d;
    }
    .word p{
      font-size:14px;
      line-height: 20px;
      color:#000000;
      padding: 10px 0;
    }
    .word p:first-child{
      padding-bottom: 0;
    }
    .word-img{
      padding:10px 0;
      overflow: hidden;
    }
    .word-img img{
      width:100px!important;
      height: 100px;
      float:left;
      margin-right:10px;
      margin-bottom: 10px;
    }
    .pl{
      position: relative;
    }
    .pl:before{
      position: absolute;
      right: -10px;
      top: 0;
      left: -10px;
      height: 1px;
      content: '';
      -webkit-transform: scaleY(.5);
      transform: scaleY(.5);
      background-color: #d6d6d6;
    }
    .pl:after{
      position: absolute;
      right: -10px;
      bottom: 0;
      left: -10px;
      height: 1px;
      content: '';
      -webkit-transform: scaleY(.5);
      transform: scaleY(.5);
      background-color: #d6d6d6;
    }
    .pl .flex-1{
      position: relative;
      height: 50px;
      color: #7c7c7c;
      font-size: 14px;
    }
    .pl .flex-1:before{
      position: absolute;
      left: 0;
      bottom: 10px;
      top: 10px;
      width: 1px;
      content: '';
      -webkit-transform: scaleX(.5);
      transform: scaleX(.5);
      background-color: #d6d6d6;
    }
    .pl .flex-1:first-child:before{
      display: none;
    }
    .pl .flex-1 img{
      width: 20px !important;
      margin-right: 10px;
    }
    .pl-tx{
    	padding:10px 0;
    }
    .pl-tx .img{
    	float:left;
    	width: 60px;
    	height: 60px;
    	margin-right:10px;
    	margin-bottom: 10px;
    }
    .pl-tx .img img{
      width: 100% !important;
      height: auto;
    }
    
    .pl-true{
      position: relative;
    }

    .pl-true:before{
      position: absolute;
      right: -10px;
      top: 0;
      left: -10px;
      height: 1px;
      content: '';
      -webkit-transform: scaleY(.5);
      transform: scaleY(.5);
      background-color: #d6d6d6;
    }
    .pl-true-img{
      padding: 10px 0;
    }
    .pl-true-img .img{
    	width: 60px;
    	height: 60px;
    	margin-right: 10px;
    }
    .pl-true-img .img img{
      width: 100% !important;
      height: auto;
    }
    .p-name{
      position: relative;
    	font-size:14px;
    	color:#195ea4;
    	padding-right: 60px;
    	padding-bottom:15px;
    }
    .p-name span.time{
      position: absolute;
      right: 0;
      top: 0;
    	color:#7c7c7c;
    }

    .p-txt{
      color: #000000;
    	font-size:14px;
    }
    .pl-hf{
      position: relative;
    	padding:10px 0;
    	padding-left: 70px;
    	background: #fff;
    }
    .pl-hf:before{
      position: absolute;
      right: -10px;
      top: 0;
      left: -10px;
      height: 1px;
      content: '';
      -webkit-transform: scaleY(.5);
      transform: scaleY(.5);
      background-color: #d6d6d6;
    }

    .pl-hf p{
    	font-size:14px;
    	color:#000000;
    }
    
    .pl-hf p span{
    	color:#7c7c7c;
    }
    
    .pl-hf p span.slip{
      margin: 0 8px;
    	color:#195ea4;
    }
    
    .pl-hf p span.txt{
    	color:#000;
    	margin-right: 10px;
    }
    .ft{
    	width:100%;
    	background:#765fc3;
    	position: fixed;
    	bottom: 0;
    	font-size: 14px;
    	color: #fff;
    	height: 50px;
    }
    .ft img{
      width: auto;
      height: 20px;
    }
    .ft span{
      margin-left: 10px;
    }
	</style>
</head>
<body>
  <header class="mui-bar mui-bar-nav">
  	<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
  	<h1 class="mui-title">病例秀详情</h1>
  </header>
  <div class="mui-content">
    <div class="main">
  		<!-- 顶部头像名字 -->
  		<div class="wb-top flex">
        <div class="img flex flex-row-center">
          <img id="headurl" src="../../images/weibo/tx.png"/>
        </div>
        <div class="flex-1">
          <h2 id="nickname">王医生</h2>
          <p>发表于：<span id="createtime">2017-05-03</span></p>
          <ins id="gzfn" class="flex flex-row-center">加关注</ins>
        </div>
      </div>
			<!-- 中间文字 AND 图片 -->
			<div class="word">
				<p id="contents"></p>
				<div id="imgs" class="word-img">
					<img src="../../images/weibo/img.png"/>
				</div>
			</div>
      <!-- 点赞评论 -->
      <div class="pl flex">
        <div class="flex-1 flex flex-row-center flex-col-center">
          <img src="../../images/blx/pl1.png" />
          <span id="read">1</span>
        </div>
        <div class="flex-1 flex flex-row-center flex-col-center">
          <img src="../../images/blx/pl2.png" />
           <span id="comments">1</span>
        </div>
        <div class="flex-1 flex flex-row-center flex-col-center">
          <img src="../../images/blx/pl3.png" />
           <span id="thing">1</span>
        </div>
      </div>			
      <!-- 下面的评论 -->
			<div class="pl-tx clearFix">
			  <div class="img flex flex-row-center">
			    <img src="../../images/weibo/pltx1.png"/>
			  </div>
			</div>
			<!-- 发表的评论 -->
			<div class="pl-true">
				<div class="pl-true-img flex">
				  <div class="img flex flex-row-center">
				    <img src="../../images/weibo/pltx3.png"/>
				  </div>
				  <div class="flex-1">
				    <p class="p-name"><span>领馆小草</span><span class="time">5小时</span> </p>
            <p class="p-txt">真的假的呀？我也想去~那个大哥哥带的假的呀？我也想去~那个大哥哥带我去</p>
				  </div>
				</div>
				<!-- 评论下面的回复 -->
        <div class="pl-hf">
          <p><span>土农民</span><span class="slip">回复</span><span>领馆小草：</span><span class="txt">是真的额,一起去吧靓仔-_-,haobuhao!</span><span>1小时前</span>
          </p>
        </div>
			</div>
		</div>
  </div>
  <footer class="ft flex" >
    <div id="fb_pl" class="flex-1 flex flex-col-center flex-row-center">
      <img src="../../images/blx/ft1.png" />
      <span>写评论</span>
    </div>
    <div class="flex-1 flex flex-col-center flex-row-center">
      <img src="../../images/blx/ft2.png" />
    </div>
    <div class="flex-1 flex flex-col-center flex-row-center">
      <img src="../../images/blx/ft3.png" />
    </div>
  </footer>
  <script src="../../js/mui.min.js"></script>
  <script src="../../js/utils.config.js"></script>
  <script src="../../js/utils.extend.js"></script>
  <script src="../../js/utils.storages.js" ></script>
  <script src="../../js/utils.auth.js"></script>
  <script src="../../js/utils.request.js"></script>
  <script>
    (function($, doc) {
        $.init({
          preloadPages:[{
            id:'KZ_BLX_PL',
            url: './blx-pl.html'
          }]
        });
        $.plusReady(function() {
          // 用户信息
          var $headurl = doc.getElementById('headurl');
          var $nickname = doc.getElementById('nickname');
          var $createtime = doc.getElementById('createtime');
          // 内容
          var $contents = doc.getElementById('contents');
          var $imgs = doc.getElementById('imgs');
          // 阅读量
          var $read = doc.getElementById('read');
          // 评论数
          var $comments = doc.getElementById('comments');
          // 点赞数
          var $thing = doc.getElementById('thing');
          // 关注
          var $gzfn = doc.getElementById('gzfn');
          var isfollow = 0;
          // 病例秀id
          var id = 0;
          // 用户id
          var uid = 0;
          // 刷新详情
          window.addEventListener('KZ_BLX_DATA', function(e){
            console.log(JSON.stringify(e.detail.data));
            setFn(e.detail.data);
          });
          // 设置详情
          var setFn = function(data) {
            id = data.id;
            $headurl.src = data.userinfo.headurl;
            $nickname.innerText = data.userinfo.nickname;
            $createtime.innerText = data.creatime;
            uid = data.userinfo.uid;
            $contents.innerText = data.contents;
            $imgs.innerHTML = '';
            if (data.cases_image) {
              var caseurllist = [];
              $.each(data.cases_image, function(i,d) {
                var img = doc.createElement('img');
                img.src = d.image;
                caseurllist.push(d.image);
                img.addEventListener('tap', function() {
                  previewImage(caseurllist, i);
                });
                $imgs.appendChild(img);
              });
            }
            $read.innerText = data.read;
            $comments.innerText = data.comments;
            $thing.innerText = data.thing;
            isfollow = data.isfollow;
            $gzfn.innerText = isfollow == 1 ? '取消关注' : '加关注';
            readFn();
            plList();
          }
          $gzfn.addEventListener('tap', function() {
            gzFn(uid, function(d) {
              if (d.status == 1) {
                $gzfn.innerText = '取消关注';
              } else {
                $gzfn.innerText = '加关注';
              }
              isfollow = d.status;
            });
          });
          // 阅读
          var readFn = function() {
             request.loginAjax('cases/read', {
                data: {
                  case_id: id,
                },
                showMsg: false
              }, function(data, success) {
                if (success) {
                }
            });
          }
          // 关注
          var gzFn = function(uid, callback) {
             request.loginAjax('cases/follow', {
                data: {
                  touid: uid,
                }
              }, function(data, success) {
                if (success) {
                  callback(data);
                }
            });
          }
           /*图片预览*/
          var previewImage = function(urllist, index) {
            plus.nativeUI.previewImage(urllist, {
              current: index,
              loop: true,
              indicator: 'number'
            });
          }
          //点赞
          var dzFn = function(caseid, callback) {
             request.loginAjax('cases/thing', {
                data: {
                  case_id: caseid,
                }
              }, function(data, success) {
                if (success) {
                  callback();
                }
            });
          }
          http://m.tianchiyueya.com:1888/tcyy/cases/getCommentsList
          // 获取评论列表
          var plList = function(callback) {
             request.loginAjax('cases/getCommentsList', {
                data: {
                  case_id: id,
                  page: 1,
                  limit: 10
                },
                showMsg: false
              }, function(data, success) {
                if (success) {
//                callback();
                }
            });
          }
          // 发表评论
          var plWebview = null;
          doc.getElementById('fb_pl').addEventListener('tap', function(){
            if (!plWebview) {
              plWebview = plus.webview.getWebviewById('KZ_BLX_PL');
            }
            $.fire(plWebview,'KZ_BLX_ID',{
              id:id
            });
            $.openWindow({
              id: 'KZ_BLX_PL'
            });
          });
        });
      })(mui, document);
  </script>
</body>

</html>

