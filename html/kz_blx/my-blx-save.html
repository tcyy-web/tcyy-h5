<!DOCTYPE html>
<html class="ui-page-my">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <title></title>
  <link href="../../css/mui.min.css" rel="stylesheet" />
  <link href="../../css/style.css" rel="stylesheet" />
  <style>
    body{
      background-color: #fff;
    }
    .mui-content{
      padding-bottom: 60px;
      height: auto;
      background: #fff;
    }
    .mui-pull-right{line-height: 44px;}
    .main{
      padding: 10px;
    }
    .wb-top{
      position: relative;
    }
    .wb-top .img{
      width: 60px;
      height:60px;
      -webkit-border-radius: 50%;
      border-radius: 50%;
      overflow: hidden;
      margin-right: 10px;
    }
    .wb-top .img img{
      width: auto;
      height: 100%;
    }
    .wb-top h2{
      font-size:16px;
      color: #010101;
      font-weight: normal;
      padding-top:5px;
      padding-bottom: 15px; 
      
    }
    .wb-top h2+p{
      font-size:14px;
      color:#7c7c7c;
    }
    .wb-top ins{
      position: absolute;
      top:5px;
      right:0;
      z-index: 3;
      text-decoration: none;
      padding:0 5px;
      background:#f4f4f4;
      height: 20px;
      border-radius: 5px;
      -webkit-border-radius: 5px;
      font-size:12px;
      color:#6d6d6d;
    }
    .word p{
      font-size:14px;
      line-height: 20px;
      color:#000000;
      padding: 10px 0;
    }
    .word p:first-child{
      padding-bottom: 0;
    }
    .word-img{
      padding:10px 0;
      overflow: hidden;
    }
    .word-img img{
      width:100px!important;
      height: 100px;
      float:left;
      margin-right:10px;
      margin-bottom: 10px;
    }
    .btns {
        position: fixed;
        bottom: 0;
        left: 0;
        font-size: 18px;
        color: #ffffff;
        text-align: center;
        height: 60px;
        line-height: 60px;
        border: 0;
        padding: 0;
        width: 100%;
      }
      .btns .sure{
        background-color: #765fc3;
      }
      .btns .cancel{
        background-color: #f14434;
      }
  </style>
</head>
<body>
  <header class="mui-bar mui-bar-nav">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    <h1 class="mui-title">病例秀详情</h1>
  </header>
  <div class="mui-content">
    <div class="main">
      <!-- 顶部头像名字 -->
      <div class="wb-top flex">
        <div class="flex-1">
          <p>创建于：<span id="createtime">2017-05-03</span></p>
        </div>
      </div>
      <!-- 中间文字 AND 图片 -->
      <div class="word">
        <p id="contents"></p>
        <div id="imgs" class="word-img">
          <img src="../../images/weibo/img.png"/>
        </div>
      </div>
    </div>
    <div class="btns flex">
      <div id="sure" class="flex-1 sure hide">发布</div>
      <div id="cancel" class="flex-1 cancel hide">删除</div>
    </div>
  </div>
  <script src="../../js/mui.min.js"></script>
  <script src="../../js/utils.common.js"></script>
  <script src="../../js/utils.config.js"></script>
  <script src="../../js/utils.extend.js"></script>
  <script src="../../js/utils.storages.js" ></script>
  <script src="../../js/utils.share.js"></script>
  <script src="../../js/utils.auth.js"></script>
  <script src="../../js/utils.request.js"></script>
  <script>
    (function($, doc) {
      var detailData = {};
      $.init();
      $.plusReady(function() {
        // 用户信息
        var $createtime = doc.getElementById('createtime');
        // 内容
        var $contents = doc.getElementById('contents');
        var $imgs = doc.getElementById('imgs');
        // 刷新详情
        window.addEventListener('MY_BLX_SAVE_DATA', function(e){
          if (e.detail.data.id != detailData.id) {
            detailData = e.detail.data;
            setFn();
          }
        });
        // 设置详情
        var setFn = function() {
          $createtime.innerText = detailData.creatime;
          $contents.innerText = detailData.contents;
          $imgs.innerHTML = '';
          if (detailData.cases_image) {
            var caseurllist = [];
            $.each(detailData.cases_image, function(i,d) {
              var img = doc.createElement('img');
              img.src = d.image;
              caseurllist.push(d.image);
              img.addEventListener('tap', function() {
                previewImage(caseurllist, i);
              });
              $imgs.appendChild(img);
            });
          }
        }
         /*图片预览*/
        var previewImage = function(urllist, index) {
          plus.nativeUI.previewImage(urllist, {
            current: index,
            loop: true,
            indicator: 'number'
          });
        }
        // 发布
        doc.getElementById('sure').addEventListener('tap', function(e){
          request.loginAjax('cases/releaseDraft', {
              data: {
                case_id: detailData.id
              }
            }, function(data, success) {
              if (success) {
                detailData.type = 1;
                console.log(111111111);
                var parent = plus.webview.currentWebview().opener();
                 $.fire(parent, 'MY_BLX_CHANGE_STATUS',{
                   data: detailData,
                   flag: true
                 });
                $.back();
              }
          });
        });
        // 删除
        doc.getElementById('cancel').addEventListener('tap', function(e){
          request.loginAjax('cases/delDraft', {
              data: {
                case_id: detailData.id
              }
            }, function(data, success) {
              if (success) {
                var parent = plus.webview.currentWebview().opener();
                 $.fire(parent, 'MY_BLX_CHANGE_STATUS',{
                   data: detailData
                 });
                $.back();
              }
          });
        });
      });
    })(mui, document);
  </script>
</body>

</html>

