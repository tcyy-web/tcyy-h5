<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>沟通</title>
		<link rel="stylesheet" href="../../css/iconfont.css" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/style.css" rel="stylesheet" />
		<style>
			.goutong-row {
				padding: 20px 0;
			}
			.goutong-row .gr-item {
	    	text-align: center;
			}
			.goutong-row .gr-item .gr-img .img-box {
				width: 60px;
				height: 60px;
				-webkit-box-sizing: border-box;
				-moz-box-sizing: border-box;
				box-sizing: border-box;
				overflow: hidden;
			}
			.goutong-row .gr-item .gr-img .img-box  img {
				width: 100%;
				height: 100%;
			}
			.goutong-row .gr-item p {
				margin-bottom: 0;
				font-size: 18px;
				margin-top: 5px;
			}
		</style>
		<style>
		  .startimgbox{
		    display: none;
		    position: fixed;
		    top: 0;
		    right: 0;
		    left: 0;
		    bottom: 0;
		    z-index: 10000;
		    background-color: #000;
		  }
		  .startimgbox .mui-slider{
		    height: 100%;
		  }
		  .startimgbox .mui-slider-group{
		    height: 100%;
		  }
		  .startimgbox .mui-slider .mui-slider-group .mui-slider-item img{
		    width: 100%;
		    height: 100%;
		  }
		  .mui-slider-indicator{
        bottom: 20px;
      }
      .mui-slider-indicator .mui-indicator{
        width: 10px;
        height: 10px;
        margin: 1px 3px;
        background-color: #b1a0e9;
        -webkit-box-shadow: none;
        box-shadow: none;
      }
      .mui-slider-indicator .mui-active.mui-indicator{
        background-color: #765fc3;
      }
      .startimgbox .ljjr{
        position: absolute;
        left: calc(50% - 50px);
        left: -webkit-calc(50% - 50px);
        bottom: 60px;
        width: 100px;
        height: 40px;
        z-index: 100;
        line-height: 40px;
        background-color: #765fc3;
        color: #fff;
        text-align: center;
        font-size: 16px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
      }
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<h1 class="mui-title">沟通</h1>
		</header>
		<div id="tab3d" class="tab3d">
		  <span>3D</span>
		</div>
		<nav class="mui-bar mui-bar-tab indextab">
      <a id="tabgt" class="item mui-active">
        <div class="iconfontbox"><i class="iconfont icon-gt"></i></div>
        <span class="mui-tab-label">沟通</span>
      </a>
      <a id="tabys" class="item left">
        <div class="iconfontbox"><i class="iconfont icon-ys"></i></div>
        <span class="mui-tab-label">演示</span>
      </a>
      <a id="tabkz" class="item right">
        <div class="iconfontbox"><i class="iconfont icon-kz"></i></div>
        <span class="mui-tab-label">扩展</span>
      </a>
      <a id="tabwd" class="item">
        <div class="iconfontbox"><i class="iconfont icon-wd"></i></div>
        <span class="mui-tab-label">我的</span>
      </a>
    </nav>
		<div class="mui-content">
			<div class="goutong-row flex">
				<div id="video" class="gr-item flex flex-col flex-1">
					<div class="gr-img flex flex-col-center">
						<div class="img-box">
							<img src="../../images/tab-goutong/img1.png" />
						</div>
					</div>
					<p>视频</p>
				</div>
				<div id="picture" class="gr-item flex flex-col flex-1">
					<div class="gr-img flex flex-col-center">
						<div class="img-box">
							<img src="../../images/tab-goutong/img2.png" />
						</div>
					</div>
					<p>图片</p>
				</div>
				<div id="yanshi" class="gr-item flex flex-col flex-1">
					<div class="gr-img flex flex-col-center">
						<div class="img-box">
							<img src="../../images/tab-goutong/img3.png" />
						</div>
					</div>
					<p>演示</p>
				</div>
			</div>
			<div class="goutong-row flex">
				<div id="threed" class="gr-item flex flex-col flex-1">
					<div class="gr-img flex flex-col-center">
						<div class="img-box">
							<img src="../../images/tab-goutong/img4.png" />
						</div>
					</div>
					<p>3D</p>
				</div>
				<div id="yuyue" class="gr-item flex flex-col flex-1">
					<div class="gr-img flex flex-col-center">
						<div class="img-box">
							<img src="../../images/tab-goutong/img5.png" />
						</div>
					</div>
					<p>预约</p>
				</div>
				<div id="project" class="gr-item flex flex-col flex-1">
					<div class="gr-img flex flex-col-center">
						<div class="img-box">
							<img src="../../images/tab-goutong/img6.png" />
						</div>
					</div>
					<p>项目</p>
				</div>
			</div>
		</div>
		<div id="startimgbox" class="startimgbox">
		  <div id="slider" class="mui-slider" >
        <div class="mui-slider-group">
          <div class="mui-slider-item">
            <img src="../../images/ppsp/banner.jpg">
            <div class="ljjr">立即进入</div>
          </div>
        </div>
        <div class="mui-slider-indicator">
        </div>
      </div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../third/knockout.js" ></script>
		<script src="../../js/utils.config.js"></script>
		<script src="../../js/utils.extend.js" ></script>
		<script src="../../js/utils.storages.js"></script>
		<script src="../../js/utils.auth.js" ></script>
		<script src="../../js/utils.request.js" ></script>
		<script src="../../js/utils.category.js"></script>
		<script src="../../js/business/tab.js" ></script>
		<script src="../../js/business/push.js"></script>
		<script>
			(function($, doc) {
					$.init({
					  preloadPages:[{
              id:'YANSHI_INDEX',
              url: '../yanshi/yanshi.html'
            }]
					});
					$.plusReady(function() {
						plus.screen.lockOrientation("portrait-primary");
					  /******APP初始化 begin******/
					  // 设置系统默认状态栏
						plus.navigator.setStatusBarBackground('#765fc3');
						// 获取基础分类
						categorys.getServer();
						/******APP初始化 end******/
						// 视频
						doc.getElementById('video').addEventListener('tap', function(event) {
              $.openWindow({
                url: '../video/video-list.html',
                id: 'VIDEO',
                preload: true,
                show: {
                  aniShow: 'pop-in'
                },
                styles: {
                  popGesture: 'hide',
                  hardwareAccelerated: true
                },
                waiting: {
                  autoShow: false
                }
              });
            });
            // 图片
            doc.getElementById('picture').addEventListener('tap', function(event) {
              $.openWindow({
                url: '../picture/picture-folders.html',
                id: 'PICTURE',
                preload: true,
                show: {
                  aniShow: 'pop-in'
                },
                styles: {
                  popGesture: 'hide'
                },
                waiting: {
                  autoShow: false
                }
              });
            });
            // 演示
            doc.getElementById('yanshi').addEventListener('tap', function(event) {
              var yanshiWebview = plus.webview.getWebviewById('YANSHI_INDEX');
              $.fire(yanshiWebview,'YANSHI_Refresh',{});
               $.openWindow({
                 id: 'YANSHI_INDEX'
               });
            });
            // 项目
            doc.getElementById('project').addEventListener('tap', function(event) {
              $.openWindow({
                url: '../project/project-index.html',
                id: 'PRODUCT-INDEX',
                preload: true,
                show: {
                  aniShow: 'pop-in'
                },
                styles: {
                  popGesture: 'hide'
                },
                waiting: {
                  autoShow: false
                }
              });
            });
            // 预约
            doc.getElementById('yuyue').addEventListener('tap', function(event) {
              $.openWindow({
                url: '../project/project-plan-date-list.html',
                id: 'PRODUCT-YUYUE',
                preload: true,
                show: {
                  aniShow: 'pop-in'
                },
                styles: {
                  popGesture: 'hide'
                },
                waiting: {
                  autoShow: false
                }
              });
            });
            // 3d
            doc.getElementById('threed').addEventListener('tap', function(e) {
              if (authManage.checkLogin()) {
                goto3D();
              } else {
                authManage.toLogin();
              }
            });
            /*启动图片*/
            var $startimgbox = doc.getElementById('startimgbox');
            var $silder = doc.getElementById('slider');
            var silder = $('#slider');
            var imgKey = '$startimgs';
            $('#startimgbox').on('tap', '.ljjr', function(){
              $startimgbox.style.display = 'none';
            });
            var paintSilder = function(data) {
              $startimgbox.style.display = 'block';
              $silder.innerHTML = '';
              var imgDiv = doc.createElement('div');
              imgDiv.className = 'mui-slider-group';
              $.each(data, function(index, d) {
                 var img = doc.createElement('div');
                 img.className = 'mui-slider-item';
                 var _img = doc.createElement('img');
                 _img.src = d.image;
                 img.appendChild(_img);
                 if (index == data.length -1 ) {
                   var _ljjr = doc.createElement('div');
                   _ljjr.className = 'ljjr';
                   _ljjr.innerText = '立即进入';
                   img.appendChild(_ljjr);
                 }
                 imgDiv.appendChild(img);
              });
              $silder.appendChild(imgDiv);
              // 画点
              var dianDiv = doc.createElement('div');
              dianDiv.className = 'mui-slider-indicator';
              $.each(data, function(index, d) {
                 var dian = doc.createElement('div');
                 if (index === 0) {
                   dian.className = 'mui-indicator mui-active';
                 } else {
                   dian.className = 'mui-indicator';
                 }
                 dianDiv.appendChild(dian);
              });
              $silder.appendChild(dianDiv);
              silder.slider({
                interval: 2000
              });
            }
            // 读缓存
            var getImageFromStorage = function() {
              var imgurl = storage.get({
                key: imgKey
              });
              if (imgurl !== null) {
                var imgs = JSON.parse(imgurl);
                if (imgs.length > 0) {
                  paintSilder(imgs);
                  return;
                }
              }
              $startimgbox.style.display = 'none';
            }
            var getImageFromServer = function() {
              request.ajax('Publics/advert',{
                showMsg: false,
                showLoading: false
              },function(data, success) {
                if (success && data && data.length > 0) {
                  paintSilder(data);
                  storage.save({
                    key: imgKey,
                    value: JSON.stringify(data)
                  });
                  return;
                }
                $startimgbox.style.display = 'none';
              }, function() {
                $startimgbox.style.display = 'none';
              });
            }
            if (!request.getNetworkState()) {
              getImageFromStorage();
            } else {
              getImageFromServer();
            }
            // tab事件
            doc.getElementById('tab3d').addEventListener('tap', function(event) {
              if (authManage.checkLogin()) {
                goto3D();
              } else {
                authManage.toLogin();
              }
            });
            doc.getElementById('tabys').addEventListener('tap', function(event) {
              var yanshiWebview = plus.webview.getWebviewById('YANSHI_INDEX');
               $.fire(yanshiWebview,'YANSHI_Refresh',{});
               $.openWindow({
                 id: 'YANSHI_INDEX'
               });
            });
            doc.getElementById('tabkz').addEventListener('tap', function(event) {
              gotoKZ();
            });
            doc.getElementById('tabwd').addEventListener('tap', function(event) {
              gotoWD();
            });
					});
				}(mui, document));
		</script>
	</body>

</html>