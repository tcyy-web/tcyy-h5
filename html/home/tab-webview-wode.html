<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>我的</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/mui.min.css">
		<link href="../../css/style.css" rel="stylesheet" />
		<style>
			p {
				text-align: center;
				margin: 0;
			}
			body,
			.mui-content {
				background-color: #eaeaea;
			}
			.mui-bar{
				-webkit-box-shadow: none;
				box-shadow: none;
			}
			.wode-header {
				position: relative;
				background-color: #765fc3;
				text-align: center;
			}
			.msg{
				padding: 12px 0;
			}
			.msg img{
				width: auto;
				height: 20px;
			}
			.wode-header .user-info {
				padding: 10px 10px 40px 10px;
			}
			.wode-header .user-info .img {
				width: 60px;
				height: 60px;
				margin-right: 20px;
				-webkit-border-radius: 50%;
				-moz-border-radius: 50%;
				border-radius: 50%;
				overflow: hidden;
			}
			.wode-header .user-info .img img {
				width: 100%;
			}
			.wode-header .user-info .info {
				padding-top: 4px;
			}
			.wode-header .user-info .info p{
				font-size: 18px;
				color: #ffffff;
				text-align: left;
				margin-top: 5px;
			}

			.count {
				padding: 10px 0;
				background-color: #ffffff;
				color: #303030;
				margin-bottom: 10px;
			}
			.count .flex-1 p:first-child {
				color: #7c7c7c;
			}
			.count p {
				height: 20px;
				line-height: 20px;
			}

			.mui-table-view {
				margin-bottom: 10px;
			}
			.mui-table-view-cell {
				font-size: 14px !important;
				padding: 14px 15px 14px 40px !important;
			}
			.mui-table-view-cell>a:not(.mui-btn) {
			    margin: -14px -15px -14px -40px !important;
			    margin-right: -40px !important;
			}
			.mui-table-view-cell a {
				color: #303030 !important;
			}
			.mui-table-view-cell img {
				position: absolute;
				left: 7px;
				top: 12px;
				width: 25px;
				height: 25px;
			}
			.mui-table-view-cell:after {
				left: 40px !important;
			}
			.btn-padding {
				padding-bottom: 20px;
			}
			.btn-logout {
				display: none;
				width: 100%;
				border: 0;
				color: #303030;
				height: 50px;
				line-height: 50px;
				background-color: #ffffff;
				padding: 0 10px;
				-webkit-border-radius: 0;
				-moz-border-radius: 0;
				border-radius: 0;
			}
			button.btn-logout:enabled,
			button.btn-logout:enabled:active{
				background-color: #ffffff ;
				opacity: 1;
			}
			
			#xiaoxi,#qiandao{
				padding-top: 10px;
				position: relative;
			}
			
			#xiaoxi #unread{
				position: absolute;
				margin-top: -16px;
				margin-left: 5px;
				padding: 0 6px;
				top:50%;
				left:50%;
				line-height: 16px;
				border-radius: 16px;
				background: #f25d8e;
				color: #fff;
				display: none;
				
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<h1 class="mui-title">我的</h1>
			<!--<a id="mymessage" class="mui-pull-right msg">
				<img src="../../images/tab-wode/msg.png" />
			</a>-->
		</header>
		<div class="mui-content">
			<div class="wode-header">
				<div class="user-info">
					<div id="login" class="flex">
						<div class="img flex flex-row-center">
							<img src="../../images/tab-wode/user_default.png" />
						</div>
						<div class="info flex-1">
							<p id="nickname">游客身份</p>
							<p id="sex">立即登录</p>
						</div>
					</div>
				</div>
			</div>
			<div class="count flex">
				<div class="flex-1" id="xiaoxi">
					<p>消息 <span id="unread">0</span></p>
					<!--<p>0</p>-->
				</div>
				<div class="flex-1" id="myjifen">
					<p>积分</p>
					<p id="totalPoint">0</p>
				</div>
				<div id="qiandao" class="flex-1">
					<p>签到</p>
					<!--<p>0</p>-->
				</div>
			</div>
			<ul class="mui-table-view mui-table-view-chevron">
				<li class="mui-table-view-cell">
					<img src="../../images/tab-wode/yqm.png"/>
					<a id="myyaoqingma" class="mui-navigate-right" href="#">
						我的邀请码
					</a>
				</li>
				<li class="mui-table-view-cell">
					<img src="../../images/tab-wode/jhm.png"/>
					<a id="myjihuoma" class="mui-navigate-right" href="#">
						我的激活码
					</a>
				</li>
				<li class="mui-table-view-cell">
					<img src="../../images/tab-wode/wdblx.png"/>
					<a id="myblx" class="clickItem mui-navigate-right">
						我的病例秀
					</a>
				</li>
				
				<li class="mui-table-view-cell">
					<img src="../../images/tab-wode/jhm.png"/>
					<a id="myorders" class="mui-navigate-right">我的订单</a>
				</li>
				
				<li class="mui-table-view-cell">
					<img src="../../images/tab-wode/tk.png"/>
					<a id="myTelephone" class="clickItem mui-navigate-right">
						绑定手机
					</a>
				</li>
				<li class="mui-table-view-cell">
					<img src="../../images/tab-wode/bdblx.png"/>
					<a id="beVip" class="mui-navigate-right" href="#">
						充值会员
					</a>
				</li>
				
				<li class="mui-table-view-cell">
					<img src="../../images/tab-wode/fk.png"/>
					<a id="fankui" class="mui-navigate-right" href="#">
						意见反馈
					</a>
				</li>
				<li class="mui-table-view-cell">
					<img src="../../images/tab-wode/gy.png"/>
					<a id="aboutAs" class="mui-navigate-right" href="#">
						关于我们
					</a>
				</li>
			</ul>


			<div class="btn-padding">
				<button id="logout" class="btn-logout">退出登录</button>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/utils.config.js"></script>
		<script src="../../js/utils.enums.js"></script>
    <script src="../../js/utils.storages.js"></script>
    <script src="../../js/utils.auth.js"></script>
    <script src="../../js/utils.request.js" ></script>
		<script>
		  window.addEventListener('refresh', function(e){
          location.reload();
      });
      window.addEventListener('info-edit-success', function(e){
          location.reload();
      });
			(function($, doc) {
				$.init();     
				$.plusReady(function() {
				  if (authManage.checkLogin()) {
				    getTotalPoint();
				    getUnread();
				  }
					var user = authManage.getUser();
					// 判断登录
					var loginItem = doc.getElementById('login');
					var logout = doc.getElementById('logout');
					// 加载登录信息
					if (authManage.checkLogin()) {
            $('#login img')[0].src = user.header || '../../images/tab-wode/user_default.png';
            $('#login #nickname')[0].innerText = user.nickname;
            $('#login #sex')[0].innerText = enums.sex[user.sex] || '未知';
            logout.style.display = 'block';
					}
					loginItem.addEventListener('tap', function(event) {
						if (authManage.checkLogin()) {
			              $.openWindow({
			                url: '../my/my.html',
			                id: 'WDJL',
			                preload: true,
			                show: {
			                  aniShow: 'pop-in'
			                },
			                styles: {
			                  popGesture: 'hide'
			                },
			                waiting: {
			                  autoShow: false
			                }
			              });
						} else {
						  authManage.toLogin();
						}
					});
					// 退出登录
					logout.addEventListener('tap', function(event) {
						$.confirm('确认退出登录？','退出登录','',function(ok){
							if (ok.index === 1) {
							  request.loginAjax('login/loginOut',{},function(data,success) {
							    if (success){
							      authManage.clearUser();
                    location.reload();
							    }
							  });
							}
						});
					});
					
					// 我的邀请码
					doc.getElementById('myyaoqingma').addEventListener('tap', function(e) {
					  
					  $.openWindow({
			              url: '../my/invite-code.html',
			              id: 'MY-YAOQINGMA',
			              preload: true,
			              show: {
			                aniShow: 'pop-in'
			              },
			              styles: {
			                popGesture: 'hide'
			              },
			              waiting: {
			                autoShow: false
			              }
			            });
			            var yqmWebview = plus.webview.getWebviewById("MY-YAOQINGMA") ;
			            $.fire( yqmWebview ,"yaoqingma",{
			            	code:authManage.getUser().spread_code
			            })
					});
					
					// 我的激活码
					var oJhm = doc.getElementById('myjihuoma');
					if( authManage.getUser().top_spread_code ){
						oJhm.style.display =="none";
					}
					oJhm&&oJhm.addEventListener('tap', function(e) {
					  $.openWindow({
			              url: '../my/active-code.html',
			              id: 'MY-JIHUOMA',
			              preload: true,
			              show: {
			                aniShow: 'pop-in'
			              },
			              styles: {
			                popGesture: 'hide'
			              },
			              waiting: {
			                autoShow: false
			              }
			            });
					});
					// 我的病例秀
					doc.getElementById('myblx').addEventListener('tap', function(e) {
					  $.openWindow({
			              url: '../kz_blx/my-blx-list.html',
			              id: 'MY-BLX',
			              preload: true,
			              show: {
			                aniShow: 'pop-in'
			              },
			              styles: {
			                popGesture: 'hide'
			              },
			              waiting: {
			                autoShow: false
			              }
			            });
					});
					// 我的积分
					doc.getElementById('myjifen').addEventListener('tap', function(e) {
					  $.openWindow({
			              url: '../my/point.html',
			              id: 'MY-JIFENSHANGCHENG',
			              preload: true,
			              show: {
			                aniShow: 'pop-in'
			              },
			              styles: {
			                popGesture: 'hide'
			              },
			              waiting: {
			                autoShow: false
			              }
			            });
					});
					
					//我的订单
					doc.getElementById('myorders').addEventListener('tap', function(e) {
					  $.openWindow({
			              url: '../my/my-orders.html',
			              id: 'MY-ORDERS',
			              show: {
			                aniShow: 'pop-in'
			              },
			              styles: {
			                popGesture: 'hide'
			              },
			              waiting: {
			                autoShow: false
			              }
			            });
					});
					
					//我的消息
					doc.getElementById('xiaoxi').addEventListener('tap', function(e) {
						
					  $.openWindow({
			              url: '../my/my-message.html',
			              id: 'MY-MESSAGE',
			              show: {
			                aniShow: 'pop-in'
			              },
			              styles: {
			                popGesture: 'hide'
			              },
			              waiting: {
			                autoShow: false
			              }
			            });
 					
					});
					
					//绑定手机
					doc.getElementById('myTelephone').addEventListener('tap', function(e) {
					  $.openWindow({
			              url: '../my/validate-phone.html',
			              id: 'MY-VALIDATA-PHONE',
			              show: {
			                aniShow: 'pop-in'
			              },
			              styles: {
			                popGesture: 'hide'
			              },
			              waiting: {
			                autoShow: false
			              }
			            });
					});
					//意见反馈
					doc.getElementById('fankui').addEventListener('tap', function(e) {
					  $.openWindow({
			              url: '../my/feedback.html',
			              id: 'myFeedback',
			              show: {
			                aniShow: 'pop-in'
			              },
			              styles: {
			                popGesture: 'hide'
			              },
			              waiting: {
			                autoShow: false
			              }
			            });
					});
					
					//关于我们
					doc.getElementById('aboutAs').addEventListener('tap', function(e) {
					  $.openWindow({
			              url: '../gongsi/index.html',
			              id: 'aboutAs',
			              show: {
			                aniShow: 'pop-in'
			              },
			              styles: {
			                popGesture: 'hide'
			              },
			              waiting: {
			                autoShow: false
			              }
			            });
					});
					
					//关于我们
					doc.getElementById('beVip').addEventListener('tap', function(e) {
					  $.openWindow({
			              url: '../payment/bevip.html',
			              id: 'beVip',
			              show: {
			                aniShow: 'pop-in'
			              },
			              styles: {
			                popGesture: 'hide'
			              },
			              waiting: {
			                autoShow: false
			              }
			            });
					});
					
					// 我的收藏
//					doc.getElementById('myshoucang').addEventListener('tap', function(e) {
//					  $.openWindow({
//			              url: '../kz_blx/my-blx-list.html',
//			              id: 'MY-BLX',
//			              preload: true,
//			              show: {
//			                aniShow: 'pop-in'
//			              },
//			              styles: {
//			                popGesture: 'hide'
//			              },
//			              waiting: {
//			                autoShow: false
//			              }
//			            });
//					});
					//qiandao
					document.getElementById("qiandao").addEventListener("tap",function(){
						request.loginAjax('user/sign', {
					        
					      }, function(data, success) {
					        if (success) {}
					    });
	

					});
				});
				
				function getTotalPoint(){
					request.loginAjax('point/getTotalPoint', {
						showLoading:false,
						showMsg: false
					  }, function(data, success) {
					    if (success) {
							document.getElementById("totalPoint").innerText = data.point;
					    }
					});
				}
				
				function getUnread(){
					request.loginAjax('Message/getUnread', {
						showLoading:false,
						showMsg: false
					  }, function(data, success) {
					    if (success) {
					    	if( data.count == 0){
					    		document.getElementById("unread").style.display = "none";
					    	}else{
					    		document.getElementById("unread").style.display = "block";
					    		document.getElementById("unread").innerText = data.count;	
					    	}
							
					    }
					});
				}

			}(mui, document));
		</script>
	</body>

</html>